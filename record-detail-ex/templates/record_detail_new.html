{% import "components/problem.html" as problem with context %}
{% extends "layout/basic.html" %}
{% block content %}
{% if typeof(rdoc['status']) === 'number' and not rev %}  
  {{ set(UiContext, 'socketUrl', "record-detail-conn?domainId=" + rdoc.domainId + "&rid=" + rdoc._id) }}  
{% endif %}
<style>
[hidden] {
  display: none !important;
}

.x-tab-header {  
  background: #fff;  
  border-bottom: 1px solid var(--border-color);  
  padding: 0;  
  margin: 0;  
}

.x-tab-header .items {  
  display: flex;  
  list-style: none;  
  margin: 0;  
  padding: 0 0.5rem;  
}

.x-tab-header .items li {  
  margin: 0;  
}

.x-tab-header .entry {  
  display: block;  
  padding: 1rem 1.5rem;  
  cursor: pointer;  
  user-select: none;  
  color: #666;  
  border: 0;  
  background: none;  
  border-bottom: 2px solid transparent;  
  transition: color 0.2s, border-color 0.2s, background-color 0.2s;  
  font-size: 0.95rem;  
}

.x-tab-header .entry:hover {  
  color: var(--main-color);  
  background-color: var(--hover-bg);  
}

.x-tab-header .entry.selected {  
  color: var(--main-color);  
  border-bottom-color: var(--main-color);  
  font-weight: 600;  
}

.x-tabs-content .x-pane {  
  display: none;  
  padding: 1.3rem;  
}

.x-tabs-content .x-pane .section__header {  
  padding: 0;  
  margin-bottom: 1rem;  
}

.x-tabs-content .x-pane .section__body {  
  padding: 0;  
}
  
.x-tabs-content .x-pane.selected,  
.x-tabs-content .x-pane.is-active {  
  display: block;  
}

.x-tabs-content .x-pane[hidden] {  
  display: none !important;  
}

.x-tabs-content .section__body {  
  padding: 0;  
}

.compiler-text {
  padding: 1em;
  white-space: pre;
  overflow: auto;
  border-left: 4px solid #ddd;
}

.x-tabs-content code[class*=language-],  
.x-tabs-content pre[class*=language-] {  
  font-size: 14.4px !important;  
}

.hydro-card-testcase-wrap {
  padding: 10px 10px;
}

.test-case-wrap {
  margin-bottom: 24px;
}

.test-case-wrap .subtask-header {
  display: flex;
  align-items: center;
  margin-bottom: 12px;
  padding: 8px 12px;
  background: #f5f5f5;
  border-radius: 4px;
  font-weight: bold;
  font-size: 0.95rem;
}

.test-case-wrap .subtask-header > span:first-child {
  margin-right: 12px;
  font-size: 1.1em;
}

.test-case-wrap .subtask-header > span:last-child {
  margin-left: auto;
  color: #666;
}

.test-case-wrap .cases-grid {
  display: flex;
  flex-wrap: wrap;
  gap: 12px 16px;
}

.test-case-wrap .case-wrapper {
  position: relative;
  width: 110px;
  margin-bottom: 12px;
}

.test-case-wrap .test-case {
  position: relative;
  width: 110px;
  height: 110px;
  padding: 12px;
  border-radius: 3px;
  color: #fff;
  font-weight: 500;
  box-shadow: 0 4px 6px rgba(50,50,93,.11),
              0 1px 3px rgba(0,0,0,.08);
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  cursor: default;
  transition: transform .2s ease, box-shadow .2s ease;
}

.test-case-wrap .test-case:hover {
  transform: translateY(-5px);
  box-shadow: 0 10px 30px rgba(50,50,93,.1),
              0 5px 15px rgba(0,0,0,.07);
}

.test-case-wrap .test-case .info {
  font-size: 0.8em;
  margin-bottom: 4px;
  line-height: 1.2;
  text-align: center;
}

.test-case-wrap .test-case .status {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  font-size: 22px;
  font-weight: bold;
  text-align: center;
  pointer-events: none;
}

.test-case-wrap .test-case .id {
  position: absolute;
  bottom: 8px;
  right: 8px;
  opacity: 0.7;
  font-size: 0.95em;
}

.test-case-wrap .case-wrapper .message {
  position: absolute;
  left: 50%;
  top: 0;
  transform: translate(-50%, -50px);
  z-index: 10;
  transition: all .25s ease;
  display: block;
  border-radius: 10px;
  box-shadow: 0 4px 6px rgba(50,50,93,.11),
              0 1px 3px rgba(0,0,0,.08);
  min-width: 12em;
  max-width: 18em;
  padding: 5px 10px;
  opacity: 0;
  color: transparent;
  background: transparent;
  pointer-events: none;
  font-size: 0.8rem;
  line-height: 1.3;
  white-space: pre-line;
}

.test-case-wrap .case-wrapper:hover .message {
  transform: translate(-50%, -70px);
  opacity: .9;
  color: #fff;
  background: #172b4d;
  pointer-events: auto;
}

/* theme--dark */

.theme--dark .x-tab-header {
  background: #323334;
  border-bottom-color: #374151;
}

.theme--dark .x-tab-header .entry {
  color: #9ca3af;
}

.theme--dark .x-tab-header .entry:hover {
  color: #60a5fa;
  background-color: rgba(55, 65, 81, 0.6);
}

.theme--dark .x-tab-header .entry.selected {
  color: #60a5fa;
  border-bottom-color: #60a5fa;
}

.theme--dark .x-tabs-content .x-pane {
  background: transparent;
}

.theme--dark .x-tabs-content .section__body {
  background: transparent;
}

.theme--dark .compiler-text {
  border-left-color: #4b5563;
  background: #020617;
  color: #e5e7eb;
}

.theme--dark .hydro-card-testcase-wrap {
  background: transparent;
}

.theme--dark .test-case-wrap .subtask-header {
  background: #020617;
  color: #e5e7eb;
}

.theme--dark .test-case-wrap .subtask-header > span:last-child {
  color: #9ca3af;
}

.theme--dark .test-case-wrap .test-case {
  box-shadow: 0 4px 10px rgba(0,0,0,.5);
}

.theme--dark .test-case-wrap .test-case:hover {
  box-shadow: 0 10px 30px rgba(0,0,0,.7),
              0 5px 15px rgba(0,0,0,.6);
}

.theme--dark .test-case-wrap .case-wrapper .message {
  box-shadow: 0 8px 24px rgba(0,0,0,.75);
}

.theme--dark .test-case-wrap .case-wrapper:hover .message {
  background: #020617; 
  color: #e5e7eb;
}
</style>
{% if rdoc.testCases.length %}
  {% set default_tab = '#pane-cases' %}
{% elif rdoc.compilerTexts.length %}
  {% set default_tab = '#pane-compiler' %}
{% else %}
  {% set default_tab = '#pane-code' %}
{% endif %}
<div class="row">
  <div class="medium-9 columns collapsed">
    {% if typeof(rdoc['status']) === 'number' %}
      {% include 'record_detail_header_new.html' %}
    {% endif %}
    <div class="section side">
      <div class="card x-tabs-content" data-x-group="record">
        <section id="pane-cases" class="x-pane{% if default_tab == '#pane-cases' %} selected{% endif %}"
  {% if default_tab != '#pane-cases' %}hidden{% endif %}>
          <div class="section__header">
            <h1 class="section__title">{{ _('Test Cases') }}</h1>
          </div>
          <div class="section__body">
            {% include 'record_detail_status_new.html' %}
          </div>
        </section>
        <section id="pane-compiler" class="x-pane{% if default_tab == '#pane-compiler' %} selected{% endif %}"
  {% if default_tab != '#pane-compiler' or not (rdoc.compilerTexts.length) %}hidden{% endif %}>
            <div class="section__header">
              <h1 class="section__title">{{ _('Compiler Texts') }}</h1>
            </div>
            <div class="section__body">
              {% include 'record_detail_compiler_new.html' %}
            </div>
        </section>
        <section id="pane-code" class="x-pane{% if default_tab == '#pane-code' %} selected{% endif %}"
  {% if default_tab != '#pane-code' %}hidden{% endif %}>
          <div class="section__header">
            <h1 class="section__title">{{ _('Code') }}</h1>
          </div>
          <div class="section__body">
            <pre class="line-numbers"><code class="language-{{ model.setting.langs[rdoc.lang].highlight }}">{{ rdoc['code'] }}</code></pre>
          </div>
        </section>
      </div>
    </div>
  </div>
  <div class="medium-3 columns">
    <div class="section side">
      <div class="section__header">
        <h1 class="section__title">{{ _('Action') }}</h1>
      </div>
      <div class="section__body no-padding">
        <ol class="menu">
          <li class="menu__item">
            <a href="?download=true" class="menu__link">
              <span class="icon icon-download"></span> {% if rdoc.files.hack %}{{ _('Download Hack Input') }}{% else %}{{ _('Download Code') }}{% endif %}
            </a>
          </li>
          {% if handler.user.hasPerm(perm.PERM_REJUDGE) and not rdoc.files.hack %}
          <li class="menu__item">
            <form method="post">
              <button type="submit" name="operation" value="rejudge" class="menu__link">
                <span class="icon icon-refresh"></span> {{ _('Rejudge') }}
              </button>
            </form>
          </li>
          <li class="menu__item">
            <form method="post">
              <button type="submit" name="operation" value="cancel" class="menu__link">
                <span class="icon icon-close"></span> {{ _('Cancel Score') }}
              </button>
            </form>
          </li>
          {% endif %}
          {% if handler.user.hasPerm(perm.PERM_SUBMIT_PROBLEM) and pdoc.config.hackable and rdoc.status === STATUS.STATUS_ACCEPTED and rdoc.uid !== handler.user._id %}
          <li class="menu__item">
            <a class="menu__link" href="{{ url('problem_hack', pid=pdoc.pid|default(pdoc.docId), rid=rdoc._id, query={tid:rdoc.contest} if rdoc.contest else {}) }}">
              <span class="icon icon-debug"></span> {{ _('Hack') }}
            </a>
          </li>
          {% endif %}
        </ol>
      </div>
      <div style="display: none"></div>
    </div>
    <div class="section side">
      <div class="section__header">
        <h1 class="section__title">{{ _('Information') }}</h1>
      </div>
      <div class="section__body typo no-media">
        {% include 'record_status_summary.html' %}
        <dl class="large horizontal">
          <dt>{{ _('Submit By') }}</dt>
          <dd>{{ user.render_inline(udoc, modbadge=false) }}</dd>
          {% if rdoc.hackTarget %}
            <dt>{{ _('Hacked') }}</dt>
            <dd><a href="{{ url('record_detail', rid=rdoc.hackTarget) }}">{{ rdoc.hackTarget }}</a></dd>
          {% endif %}
          {% if pdoc %}
            <dt>{{ _('Problem') }}</dt>
            <dd>
              {{ problem.render_problem_title(pdoc, tdoc, show_tags=false, show_invisible_flag=false) }}
            </dd>
          {% endif %}
          {% if tdoc %}
            <dt>{{ _('Homework') if tdoc.rule == 'homework' else _('Contest') }}</dt>
            <dd>
              <a href="{{ url('homework_detail' if tdoc.rule == 'homework' else 'contest_detail', tid=tdoc.docId) }}">{{ tdoc.title }}</a>
            </dd>
          {% endif %}
          {% if pdoc.config.type != 'objective' %}
            <dt>{{ _('Language') }}</dt>
            <dd>{{ model.setting.langs[rdoc.lang].display }}</dd>
          {% endif %}
          {% if rdoc.code %}
            <dt>{{ _('Code Length') }}</dt>
            <dd>{{ size(rdoc.code|length) }}</dd>
          {% endif %}
          <dt>{{ _('Submit At') }}</dt>
          <dd>{{ datetimeSpan(rdoc._id, false)|safe }}</dd>
          {% if rdoc.judgeAt %}
            <dt>{{ _('Judged At') }}</dt>
            <dd>{{ datetimeSpan(rdoc.judgeAt, false)|safe }}</dd>
          {% endif %}
          {% if judge_udoc %}
            <dt>{{ _('Judged By') }}</dt>
            <dd>{{ user.render_inline(judge_udoc, badge=false) }}</dd>
          {% endif %}
        </dl>
        {% if typeof(rdoc['status']) === 'number' %}
          {% include 'record_detail_summary.html' %}
        {% endif %}
      </div>
    </div>
    {% if allRevs|length %}
      <div class="section side">
        <div class="section__header">
          <h1 class="section__title">{{ _('History') }}</h1>
        </div>
        <div class="section__body no-padding">
          <ol class="menu">
            <li class="menu__item">
              <a href="?rev=" {% if not rev %}style="border-color: #4690d0;"{% endif %} class="menu__link">
                {{ _('Latest Version') }}
              </a>
            </li>
            {% for r, rtime in allRevs %}
            <li class="menu__item">
              <a href="?rev={{ r }}" {% if rev and rev.equals(r) %}style="border-color: #4690d0;"{% endif %} class="menu__link">
                {{ datetimeSpan(rtime, false)|safe }}
              </a>
            </li>
            {% endfor %}
          </ol>
        </div>
      </div>
    {% endif %}
  </div>
</div>
<script>
  window.addEventListener('load', function() {
    console.log('Powered by OpenBPJudge Project https://github.com/BPJudge/open-bpjudge');
  }, {once : true});
</script>
{% endblock %}
